# Testing PRISM changes with prismatique

This guide shows how to exercise local code changes (including the updated HRTEM tilt interpolation) through the `prism` command-line interface while using prismatique to orchestrate runs.

## 1. Build a local CLI binary

The command-line driver is built by default. From the repository root, create a build directory and compile the CLI target:

```bash
cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
cmake --build build --target prism
```

See the command-line reference for available flags such as `--input-file`, `--output-file`, `--interp-factor`, `--alpha-max`, and `--num-threads`. The same flags are passed through when prismatique launches the binary.

## 2. Prepare an input deck for your tilt test

Use an atomic model such as `SI100.XYZ` (included at the repository root) and the parameter file generated by your Python wrapper that encodes the desired HRTEM tilts. The new interpolation logic accepts arbitrary tilt coordinates, so you do not need to snap them to the Fourier grid before handing them to prismatique.

## 3. Create a prismatique job file

Prismatique runs arbitrary commands. Point it at the locally built `prism` binary and include the same arguments you would use interactively. A minimal YAML job could look like:

```yaml
working_directory: prismatique-output
runs:
  - name: hrtem-tilt-interpolation
    command: >
      ${PRISM_BIN:-./build/bin/prism}
      --input-file SI100.XYZ
      --output-file prismatique-output/hrtem_tilts.h5
      --algorithm p
      --interp-factor 8
      --pixel-size 0.05
      --cell-dimension 20 20 20
      --energy 300
      --alpha-max 25
    env:
      PRISMATIC_PARAM_FILE: hrtem_params.txt
```

Add any additional flags (for example `--num-threads`, `--num-gpus`, or your S-matrix options) that you normally use. The `env` section is optional but can be helpful if your wrapper expects environment variables to locate the parameter file or output folder.

## 4. Run the job

With prismatique installed in your environment, launch the workflow and inspect the generated HDF5 output:

```bash
prismatique run hrtem-prismatique.yaml
ls prismatique-output
```

If you keep the working directory inside your repository, the run will pick up the latest compiled binary and the tilt metadata emitted by your wrapper. You can rerun the same job after rebuilding to compare HRTEM S-matrix outputs before and after code changes.
